### インフラのセットアップ

```bash
cd ops/02_staging
vagrant up
vagrant ssh
```

```bash
cd /vagrant
./src/build/sh/build.sh
source ~/.bash_profile
exit
vagrant reload
```

```bash
cd /vagrant/build
sudo chef-client -z -j provision.json
```

#### EC2キーペアの作成
```bash
cd /vagrant/config/secure/
../../src/build/aws/ec2/create_key_pare.sh
```
再作成をする場合は以下のコマンドで秘密鍵を削除してからコピーする
```bash
rm  ~/.ssh/$STG_SSH_KEY
cp $STG_SSH_KEY  ~/.ssh/
chmod 0400 ~/.ssh/$STG_SSH_KEY
```

#### VPCの作成
```bash
cd /vagrant/src/build/aws/vpc/
aws cloudformation validate-template --template-body file://$STG_VPC_TEMPLATE
chmod 0755 ./create_stack.sh
./create_stack.sh
aws cloudformation list-stack-resources --stack-name $STG_VPC_STACKNAME --output table
```

#### セキュリティグループを作成する
```bash
cd /vagrant/src/build/aws/ec2/
./create_security_group.sh
```
作成されたセキュリティグループIDを環境変数に設定して環境変数を読み込み直した後に以下のコマンドを実行する
```bash
./configure_security_group_rule.sh
```
