### インフラのセットアップ

```bash
cd ops/01_development
vagrant up
vagrant ssh
```

```bash
cd /vagrant
./src/build/sh/build.sh
source ~/.bash_profile
exit
vagrant reload
```

```bash
cd /vagrant/build
sudo chef-client -z -j provision.json
```

#### EC2キーペアの作成
```bash
cd /vagrant/config/secure/
../../src/build/aws/ec2/create_key_pare.sh
```
再作成をする場合は以下のコマンドで秘密鍵を削除してからコピーする
```bash
$ rm  ~/.ssh/$DEV_SSH_KEY
```

#### VPCの作成
```bash
$ cd /vagrant/ops/03_production/src/build/aws/vpc/
$ aws cloudformation validate-template --template-body file://$PRD_VPC_TEMPLATE
$ chmod 0755 ./vpc-create-stack.sh
$ ./vpc-create-stack.sh
$ aws cloudformation list-stack-resources --stack-name $PRD_VPC_STACKNAME --output table
```

#### セキュリティグループを作成する
```bash
$ cd /vagrant/ops/03_production/src/ship/aws/ec2/
$ ./ec2-create-security-group.sh
```
作成されたセキュリティグループIDを環境変数に設定して環境変数を読み込み直した後に以下のコマンドを実行する
```bash
$ ./ec2-security-group-rule.sh
```

#### 仮想マシンセットアップ
```bash
cd /vagrant/build
vagrant up --provider=aws
```
起動完了後にインスタンスIDを環境変数に登録する
```bash
$ PRD_EC2_INSTANCE_ID=`cat .vagrant/machines/default/aws/id | sed  "s/$//g"`
$ echo $PRD_EC2_INSTANCE_ID
  i-05a331dc8dc22a47b
```
インスタンスのパブリックIPアドレスを`/vagrant/scripts/install_dependencies`のPRD_URL設定する
```bash
$ PRD_EC2_PUBLIC_IP=`aws ec2  describe-instances --instance-ids ${PRD_EC2_INSTANCE_ID} | grep PublicIpAddress | awk {'print $2 '} | sed s/,//g | sed s/\"//g`
$ echo $PRD_EC2_PUBLIC_IP
13.114.39.124
```
リソース名を統一する
```bash
$ /vagrant/ops/03_production/src/ship/aws/ec2/ec2-setup-resources.sh
```

### アプリケーションのセットアップ
```bash
sudo gem install bundler
sudo gem install rails
rails new . -d mysql
```