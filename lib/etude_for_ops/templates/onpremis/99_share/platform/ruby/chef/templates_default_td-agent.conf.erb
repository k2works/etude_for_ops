<source>
type forward
port 24224
</source>

<source>
type tail
path /var/log/nginx/access.log
pos_file /var/log/td-agent/web.access.pos
format nginx
tag web.access
</source>

<source>
type tail
path /var/log/nginx/error.log
pos_file /var/log/td-agent/web.error.pos
format nginx
tag web.error
</source>

<source>
type tail
path /var/app/current/log/development.log
pos_file /var/log/td-agent/app.development.pos
format multiline
format_firstline /^Started/
format1 /Started (?<method>[^ ]+) "(?<path>[^"]+)" for (?<host>[^ ]+) at (?<time>[^ ]+ [^ ]+ [^ ]+)\n/
format2 /Processing by (?<controller>[^\u0023]+)\u0023(?<controller_method>[^ ]+) as (?<format>[^ ]+?)\n/
format3 /(  Parameters: (?<parameters>[^ ]+)\n)?/
format4 /  Rendered (?<template>[^ ]+) within (?<layout>.+) \([\d\.]+ms\)\n/
format5 /Completed (?<code>[^ ]+) [^ ]+ in (?<runtime>[\d\.]+)ms \(Views: (?<view_runtime>[\d\.]+)ms \| ActiveRecord: (?<ar_runtime>[\d\.]+)ms\)/
tag app.development
</source>

<match *.*>
type stdout
</match>

<source>
@type forward
port 24224
</source>

<match app.development>
@type rewrite_tag_filter
rewriterule1 severity INFO app.development.info
rewriterule2 severity FATAL app.development.fatal
</match>

<match app.development.info>
@type parser
key_name messages
format json
tag rails
</match>

<match rails>
type record_reformer
enable_ruby true
tag rails.timestamp
<record>
@timestamp ${time.strftime('%Y-%m-%dT%H:%M:%S%z')}
</record>
</match>

<match rails.timestamp>
@type elasticsearch
host localhost
port 9200
index_name app-development
type_name fluentd
</match>

<match app.development.fatal>
type record_reformer
enable_ruby true
tag rails.fatal.timestamp
<record>
@timestamp ${time.strftime('%Y-%m-%dT%H:%M:%S%z')}
</record>
</match>

<match rails.fatal.timestamp>
@type elasticsearch
host localhost
port 9200
index_name app-development-fatal
type_name app-fatal
</match>