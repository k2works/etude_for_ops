include_recipe 'awscli'
include_recipe 'aws'

user = node['user']

execute 'install pip' do
  command 'curl -kL https://bootstrap.pypa.io/get-pip.py | python'
end

# https://github.com/docker/compose/issues/5883
execute 'reinstall pip' do
  command 'pip install --upgrade --force-reinstall pip==9.0.3'
end

execute 'install awsebcli' do
  user user
  cwd "home/#{user}"
  command 'sudo pip install awsebcli --upgrade --user'
  environment(
      'HOME' => "home/#{user}",
      'USER' => user,
  )
end

bash "install Amazon ECS CLI" do
  code <<-EOC
    curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
    sudo chmod +x /usr/local/bin/ecs-cli
  EOC
  not_if {File.exists?("/usr/local/bin/ecs-cli")}
end
